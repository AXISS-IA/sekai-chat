<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEKAI VOICE | GitHub Ops</title>
    <style>
        :root { 
            --glow: #00ff00; 
            --tx: #ff3333; 
            --bg: #0a0a0a; 
            --panel: #151515;
        }

        body { 
            background: var(--bg); 
            color: white; 
            font-family: 'Courier New', monospace; 
            margin: 0; 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Cabezal de Estado */
        header {
            padding: 30px 20px 10px;
            text-align: center;
        }

        #status-text { 
            font-size: 2.2rem; 
            color: var(--glow); 
            text-shadow: 0 0 20px var(--glow); 
            margin: 0;
            transition: 0.2s;
        }

        #mode-info { 
            font-size: 0.75rem; 
            color: #555; 
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 5px;
        }

        /* Zona Central Interactiva */
        #main-display { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
        }

        #visualizer-container { 
            position: relative; 
            width: 300px; 
            height: 300px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }

        canvas { 
            position: absolute; 
            inset: 0; 
            z-index: 1; 
        }

        #central-core { 
            width: 110px; 
            height: 110px; 
            background: #111; 
            border: 5px solid var(--glow); 
            border-radius: 50%; 
            z-index: 5; 
            transition: transform 0.1s, border-color 0.2s, box-shadow 0.2s;
            display: flex; 
            justify-content: center; 
            align-items: center;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
        }

        #central-core:active {
            transform: scale(0.92);
        }

        /* Footer con ID de Operador */
        footer { 
            background: var(--panel); 
            padding: 25px; 
            border-top: 1px solid #222; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            border-radius: 30px 30px 0 0;
        }

        .avatar { 
            width: 55px; 
            height: 55px; 
            border-radius: 50%; 
            border: 2px solid var(--glow); 
            background: #222 url('https://via.placeholder.com/150') center/cover; 
        }

        .info-box {
            display: flex;
            flex-direction: column;
        }

        .op-name { font-size: 0.9rem; font-weight: bold; color: var(--glow); }
        .op-status { font-size: 0.65rem; color: #444; }

    </style>
</head>
<body>

    <header>
        <div id="status-text">144.500 MHz</div>
        <div id="mode-info">SISTEMA LISTO</div>
    </header>

    <div id="main-display">
        <div id="visualizer-container">
            <canvas id="visualizer" width="300" height="300"></canvas>
            <div id="central-core">
                <div style="width: 25px; height: 25px; border-radius: 50%; background: var(--glow); opacity: 0.4;"></div>
            </div>
        </div>
        <p style="color: #333; font-size: 0.7rem; margin-top: 50px; text-align: center;">
            MANTENER PARA HABLAR<br>1 SEGUNDO PARA BLOQUEO (LOCK)
        </p>
    </div>

    <footer>
        <div class="avatar"></div>
        <div class="info-box">
            <div class="op-name">OPERADOR SEKAI</div>
            <div class="op-status">CONEXIÓN SEGURA • TERMINAL MÓVIL</div>
        </div>
    </footer>

    <script>
        let audioCtx, analyser, dataArray, canvas, ctx;
        let pressTimer, isLocked = false, isTransmitting = false;

        const core = document.getElementById('central-core');
        const statusText = document.getElementById('status-text');
        const modeInfo = document.getElementById('mode-info');

        // --- MOTOR DE AUDIO ---
        async function startSystem() {
            if (audioCtx) return;
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                const source = audioCtx.createMediaStreamSource(stream);
                analyser.fftSize = 64;
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                source.connect(analyser);
                
                canvas = document.getElementById('visualizer');
                ctx = canvas.getContext('2d');
                draw();
            } catch (e) {
                alert("Error: Activa el micrófono para usar el chat.");
            }
        }

        function draw() {
            requestAnimationFrame(draw);
            analyser.getByteFrequencyData(dataArray);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const cx = canvas.width/2, cy = canvas.height/2;
            
            dataArray.forEach((val, i) => {
                const angle = (i * 2 * Math.PI) / dataArray.length;
                const h = (val / 255) * 60; // Altura reactiva
                ctx.strokeStyle = isTransmitting ? '#ff3333' : '#00ff00';
                ctx.lineWidth = 4;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(cx + Math.cos(angle)*75, cy + Math.sin(angle)*75);
                ctx.lineTo(cx + Math.cos(angle)*(75+h), cy + Math.sin(angle)*(75+h));
                ctx.stroke();
            });

            // Pequeña pulsación en el núcleo
            const scale = 1 + (dataArray[10] / 255) * 0.1;
            core.style.transform = `scale(${scale})`;
        }

        // --- SONIDOS TÁCTICOS ---
        function playTone(type) {
            const ac = new (window.AudioContext || window.webkitAudioContext)();
            const o = ac.createOscillator();
            const g = ac.createGain();
            o.connect(g); g.connect(ac.destination);
            g.gain.value = 0.08;

            if(type === 'in') {
                o.frequency.value = 900; 
                o.start(); 
                o.stop(ac.currentTime + 0.06);
            } else {
                // Roger Beep Clásico
                o.frequency.setValueAtTime(1100, ac.currentTime);
                o.start();
                o.frequency.exponentialRampToValueAtTime(550, ac.currentTime + 0.2);
                o.stop(ac.currentTime + 0.2);
            }
        }

        // --- CONTROL TÁCTIL (MÓVIL) ---
        core.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if(isLocked) return;
            
            startTX();
            pressTimer = setTimeout(lockTX, 1000);
        });

        core.addEventListener('touchend', () => {
            clearTimeout(pressTimer);
            if(!isLocked) stopTX();
        });

        // Click para liberar el bloqueo
        core.addEventListener('click', () => {
            if(isLocked) stopTX();
        });

        function startTX() {
            isTransmitting = true;
            startSystem(); // Inicia audio al primer toque
            playTone('in');
            
            core.style.borderColor = 'var(--tx)';
            core.style.boxShadow = '0 0 30px rgba(255, 51, 51, 0.4)';
            statusText.style.color = 'var(--tx)';
            statusText.style.textShadow = '0 0 20px var(--tx)';
            modeInfo.innerText = "TRANSMITIENDO...";
        }

        function stopTX() {
            if(isTransmitting) playTone('out');
            isTransmitting = false; 
            isLocked = false;
            
            core.style.borderColor = 'var(--glow)';
            core.style.boxShadow = '0 0 15px rgba(0, 255, 0, 0.2)';
            statusText.style.color = 'var(--glow)';
            statusText.style.textShadow = '0 0 20px var(--glow)';
            modeInfo.innerText = "SISTEMA LISTO";
        }

        function lockTX() {
            isLocked = true;
            modeInfo.innerText = "MODO MANOS LIBRES (LOCKED)";
            if(navigator.vibrate) navigator.vibrate([100, 50, 100]); // Vibración de confirmación
        }
    </script>
</body>
</html>
