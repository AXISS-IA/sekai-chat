<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA MANDO TÁCTICO | GitHub Ops</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --glow: #00ff00; --bg: #0a0a0a; --panel: #151515; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; overflow: hidden; }

        /* PANTALLA LOGIN */
        #login-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; }

        /* PANEL IZQUIERDO: DIAL */
        #panel-izq { width: 280px; background: var(--panel); border-right: 2px solid #222; display: flex; flex-direction: column; padding: 15px; }
        #lista-canales { overflow-y: auto; flex: 1; }
        .frecuencia-card { background: #1e1e1e; padding: 12px; margin-bottom: 8px; border-radius: 5px; cursor: pointer; border: 1px solid #333; }
        .frecuencia-card.active { border-color: var(--glow); box-shadow: inset 0 0 10px rgba(0,255,0,0.2); }
        .mhz { color: var(--glow); font-family: monospace; font-size: 1.1rem; }

        /* ZONA CENTRAL */
        #zona-comunicacion { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
        #display-central { display: flex; align-items: center; gap: 20px; margin-bottom: 40px; }
        .flecha { background: none; border: 2px solid #333; color: var(--glow); font-size: 1.5rem; cursor: pointer; padding: 10px 20px; border-radius: 10px; }
        .flecha:hover { background: #111; border-color: var(--glow); }
        #status-text { font-family: monospace; font-size: 1.4rem; color: var(--glow); min-width: 260px; text-align: center; text-shadow: 0 0 10px var(--glow); }

        #ptt-button { width: 240px; height: 240px; background: radial-gradient(circle, #333, #000); border: 8px solid #444; border-radius: 50%; cursor: pointer; transition: 0.1s; display: flex; justify-content: center; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #ptt-button.active { border-color: #ff3333; transform: scale(0.95); box-shadow: 0 0 40px rgba(255, 51, 51, 0.4); }
        #ptt-button.handsfree { border-color: #33ff77; box-shadow: 0 0 40px rgba(51, 255, 119, 0.4); }

        /* PANEL DERECHO: USUARIOS */
        #panel-der { width: 300px; background: var(--panel); border-left: 2px solid #222; padding: 15px; display: flex; flex-direction: column; }
        .usuario-item { display: flex; align-items: center; padding: 12px; background: #1e1e1e; margin-bottom: 10px; border-radius: 10px; cursor: pointer; border: 1px solid transparent; }
        .avatar { width: 50px; height: 50px; border-radius: 50%; background-size: cover; background-position: center; border: 2px solid var(--glow); margin-right: 12px; }
        
        /* MODALES */
        #modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a1a; padding: 30px; border-radius: 20px; z-index: 100; border: 2px solid #333; width: 320px; text-align: center; }
        .btn { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; }
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 99; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <h1 style="color: var(--glow); letter-spacing: 5px;">MANDO TÁCTICO</h1>
        <div id="g_id_onload" data-client_id="TU_GOOGLE_ID" data-callback="handleSignIn"></div>
        <div class="g_id_signin" data-type="standard"></div>
        <button onclick="bypassLogin()" style="background:none; border:1px solid #444; color:#444; margin-top:30px; padding:10px; cursor:pointer;">MODO INVITADO (DEMO)</button>
    </div>

    <aside id="panel-izq">
        <h3 style="color:#555; font-size:0.7rem; text-transform:uppercase;">Receptor Multi-Banda</h3>
        <div id="lista-canales"></div>
    </aside>

    <main id="zona-comunicacion">
        <div id="display-central">
            <button class="flecha" onclick="cambiarCanal(-1)">◀</button>
            <div id="status-text">144.500 MHz</div>
            <button class="flecha" onclick="cambiarCanal(1)">▶</button>
        </div>

        <div id="ptt-button" onmousedown="startPTT()" onmouseup="stopPTT()" onclick="toggleHandsFree(event)">
            <div style="width:70px; height:70px; background:#222; border-radius:50%; border:2px solid #444;" id="inner-btn"></div>
        </div>
        <p id="mode-info" style="color:#444; margin-top:25px; font-size:0.8rem;">PULSACIÓN PARA TRANSMITIR</p>
    </main>

    <aside id="panel-der">
        <h3 style="color:#555; font-size:0.7rem; text-transform:uppercase;">Usuarios en Frecuencia</h3>
        <div id="user-me" class="usuario-item" onclick="abrirMiPerfil()">
            <div class="avatar" id="mi-avatar" style="background-image:url('https://via.placeholder.com/150')"></div>
            <div>
                <b class="nombre-usuario" id="mi-nombre" style="font-size:0.9rem;">ESPERANDO LOGIN...</b>
                <div style="font-size:0.7rem; color:var(--glow);">IDENTIDAD CONFIRMADA</div>
            </div>
        </div>
        <div id="otros-usuarios"></div>
    </aside>

    <div class="overlay" id="overlay" onclick="cerrarModal()"></div>
    <div id="modal">
        <h2 id="modal-nombre" style="margin:0 0 20px 0; color:var(--glow); font-family:monospace;">PERFIL</h2>
        <div id="opciones-yo">
            <button class="btn" style="background:#333; color:white;" onclick="cambiarNombre()">Editar Callsign</button>
            <button class="btn" style="background:#333; color:white;" onclick="document.getElementById('fileInput').click()">Subir GIF/Imagen</button>
            <input type="file" id="fileInput" style="display:none" accept="image/*" onchange="subirImagen(event)">
        </div>
        <button class="btn" style="background:#444; color:white; margin-top:15px;" onclick="cerrarModal()">Cerrar</button>
    </div>

    <script>
        let isHandsFree = false;
        let canalActualIdx = 0;

        // Cargar datos guardados al iniciar
        window.onload = () => {
            const savedName = localStorage.getItem('callsign') || "ALMIRANTE";
            const savedImg = localStorage.getItem('avatarImg') || "https://via.placeholder.com/150";
            document.getElementById('mi-nombre').innerText = savedName;
            document.getElementById('mi-avatar').style.backgroundImage = `url(${savedImg})`;
            initCanales();
        };

        function initCanales() {
            const lista = document.getElementById('lista-canales');
            for(let i=0; i<50; i++) {
                const f = (100 + Math.random()*800).toFixed(3);
                const item = document.createElement('div');
                item.className = 'frecuencia-card';
                item.onclick = () => sintonizar(i, f);
                item.innerHTML = `<span class="mhz">${f} MHz</span><br><small style="color:#444">USR: ${Math.floor(Math.random()*15)}/15</small>`;
                lista.appendChild(item);
            }
            sintonizar(0, "144.500");
        }

        function sintonizar(idx, mhz) {
            canalActualIdx = idx;
            document.querySelectorAll('.frecuencia-card').forEach((c,i) => c.classList.toggle('active', i === idx));
            document.getElementById('status-text').innerText = mhz + " MHz";
            new Audio('https://www.soundjay.com/communication/sounds/radio-static-1.mp3').play();
        }

        function cambiarCanal(dir) {
            let cards = document.querySelectorAll('.frecuencia-card');
            canalActualIdx = (canalActualIdx + dir + cards.length) % cards.length;
            cards[canalActualIdx].click();
            cards[canalActualIdx].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function startPTT() { if(!isHandsFree) setTransmit(true); }
        function stopPTT() { if(!isHandsFree) setTransmit(false); }
        
        function toggleHandsFree(e) {
            isHandsFree = !isHandsFree;
            setTransmit(isHandsFree);
            document.getElementById('ptt-button').classList.toggle('handsfree', isHandsFree);
            document.getElementById('mode-info').innerText = isHandsFree ? "MANOS LIBRES ACTIVO" : "PULSACIÓN PARA TRANSMITIR";
        }

        function setTransmit(on) {
            const btn = document.getElementById('ptt-button');
            document.getElementById('status-text').style.color = on ? "#ff3333" : "#00ff00";
            btn.classList.toggle('active', on);
        }

        function handleSignIn(response) {
            const payload = JSON.parse(atob(response.credential.split('.')[1]));
            document.getElementById('mi-nombre').innerText = payload.name.toUpperCase();
            document.getElementById('mi-avatar').style.backgroundImage = `url(${payload.picture})`;
            localStorage.setItem('callsign', payload.name.toUpperCase());
            localStorage.setItem('avatarImg', payload.picture);
            bypassLogin();
        }

        function bypassLogin() { document.getElementById('login-overlay').style.display = 'none'; }
        function abrirMiPerfil() { document.getElementById('modal').style.display = 'block'; document.getElementById('overlay').style.display = 'block'; }
        function cerrarModal() { document.getElementById('modal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; }

        function cambiarNombre() {
            const n = prompt("Nuevo Callsign:");
            if(n) {
                document.getElementById('mi-nombre').innerText = n.toUpperCase();
                localStorage.setItem('callsign', n.toUpperCase());
            }
        }

        function subirImagen(e) {
            const reader = new FileReader();
            reader.onload = () => {
                const imgData = reader.result;
                document.getElementById('mi-avatar').style.backgroundImage = `url(${imgData})`;
                localStorage.setItem('avatarImg', imgData);
            };
            reader.readAsDataURL(e.target.files[0]);
        }
    </script>
</body>
</html>
