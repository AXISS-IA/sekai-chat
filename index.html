import random

class SekaiUser:
    def __init__(self, username, balance=1000):
        self.username = username
        self.balance = balance
        self.inventory = []
        self.status = "Libre"  # Libre o Prisionero
        self.infractions = 0

    def __str__(self):
        return f"[{self.status}] {self.username} - Balance: {self.balance}Â¥ - Inventario: {len(self.inventory)} objetos"

class SekaiEngine:
    def __init__(self):
        self.relics_pool = {
            "ComÃºn": ["Llave de Cobre", "Fragmento de CÃ³digo"],
            "Raro": ["Daga de Cristal", "Pase de Distrito"],
            "Ã‰pico": ["Ojo de Vigilante", "Cifrado Maestro"],
            "Legendario": ["Reliquia Ancestral de Sekai"]
        }

    def pull_gacha(self, user):
        cost = 500
        if user.balance < cost:
            return "âŒ Fondos insuficientes para el Gacha."
        
        user.balance -= cost
        # Probabilidades: 70% ComÃºn, 20% Raro, 8% Ã‰pico, 2% Legendario
        rarity = random.choices(
            ["ComÃºn", "Raro", "Ã‰pico", "Legendario"], 
            weights=[70, 20, 8, 2]
        )[0]
        
        item = random.choice(self.relics_pool[rarity])
        user.inventory.append(item)
        return f"âœ¨ Â¡{user.username} ha obtenido [{rarity}] {item}!"

    def apply_prison_protocol(self, user, reason):
        user.status = "Prisionero"
        user.infractions += 1
        return f"ðŸš¨ PROTOCOLO DE SEGURIDAD ðŸš¨\nFicha de Prisionero: {user.username}\nInfracciÃ³n: {reason}\nEstado: Procesando en la PrisiÃ³n de Sekai..."

# --- PRUEBA DEL SISTEMA ---
engine = SekaiEngine()
player = SekaiUser("Explorer_01")

print(f"--- Inicio de SesiÃ³n ---")
print(player)

print(f"\n--- Intentando Gacha ---")
print(engine.pull_gacha(player))
print(player)

print(f"\n--- Activando Protocolo de Seguridad ---")
if player.balance < 600: # SimulaciÃ³n de una falta por 'insolvencia' o conducta
    print(engine.apply_prison_protocol(player, "Intento de hackeo en Distrito de Lujo"))

print(player)
