<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SekaiChat | AXISS-IA</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --p: #00d2ff; --s: #9d50bb; --bg: #f0f2f5;
            --glass: rgba(255, 255, 255, 0.85);
            --border: rgba(255, 255, 255, 0.6);
            --sidebar-w: 70px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Segoe UI', sans-serif; background: #e6e9f0; overflow: hidden; }

        /* PANTALLA LOGIN */
        #login-screen { position: fixed; inset: 0; z-index: 1000; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #00d2ff, #9d50bb); padding: 20px; }
        .login-card { background: white; padding: 2.5rem; border-radius: 30px; width: 100%; max-width: 380px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }

        /* CONTENEDOR PRINCIPAL */
        #chat-screen { display: none; flex-direction: row; height: 100vh; }

        /* SIDEBAR (Botones al costado) */
        .sidebar { 
            width: var(--sidebar-w); background: #ffffff; border-right: 1px solid #ddd;
            display: flex; flex-direction: column; align-items: center; padding: 15px 0; gap: 15px;
            z-index: 10;
        }
        .btn-sala {
            width: 50px; height: 50px; border-radius: 15px; border: none;
            background: #f0f2f5; font-size: 20px; cursor: pointer;
            transition: 0.3s; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .btn-sala:hover { border-radius: 12px; background: var(--p); color: white; }
        .btn-sala.active { border-radius: 12px; background: linear-gradient(135deg, var(--p), var(--s)); color: white; box-shadow: 0 5px 15px rgba(0, 210, 255, 0.3); }

        /* √ÅREA DE CHAT */
        .main-content { flex: 1; display: flex; flex-direction: column; background: #f0f2f5; position: relative; }
        
        .chat-header { background: white; padding: 15px 20px; font-weight: bold; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }

        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }

        /* BURBUJAS */
        .bubble { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 15px; line-height: 1.4; animation: pop 0.2s ease; }
        .mine { align-self: flex-end; background: white; border: 1px solid var(--p); border-bottom-right-radius: 4px; }
        .others { align-self: flex-start; background: white; border: 1px solid #ddd; border-bottom-left-radius: 4px; }
        .u-label { font-size: 10px; font-weight: 800; color: var(--s); text-transform: uppercase; margin-bottom: 3px; display: block; }

        /* PERFIL DE USUARIO (Abajo en el sidebar) */
        .user-profile { margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 5px; padding-bottom: 10px; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(to bottom, #eee, #ccc); border: 2px solid var(--p); display: flex; align-items: center; justify-content: center; font-weight: bold; color: #555; overflow: hidden; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }

        /* INPUT */
        .input-bar { padding: 15px; background: white; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; border: 1px solid #eee; padding: 12px 18px; border-radius: 20px; background: #f9f9f9; outline: none; font-size: 16px; }
        .btn-send { width: 45px; height: 45px; border-radius: 50%; border: none; background: var(--p); color: white; cursor: pointer; }

        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h2 style="margin:0; font-size: 24px;">üèØ SekaiChat</h2>
            <p style="color:#888; font-size: 14px; margin: 5px 0 25px;">Configura tu perfil</p>
            <div id="avatar-preview" class="avatar" style="margin: 0 auto 15px; width: 70px; height: 70px; font-size: 24px;">?</div>
            <input type="text" id="nick" placeholder="Tu Nickname..." style="width:100%; text-align:center; margin-bottom:15px;">
            <button onclick="iniciar()" style="width:100%; padding:15px; border-radius:30px; border:none; background:var(--p); color:white; font-weight:bold; cursor:pointer;">ENTRAR</button>
        </div>
    </div>

    <div id="chat-screen">
        <div class="sidebar">
            <button onclick="setSala('mundo')" id="s-mundo" class="btn-sala active" title="Global">üåé</button>
            <button onclick="setSala('otaku')" id="s-otaku" class="btn-sala" title="Otaku">üéé</button>
            <button onclick="setSala('gaming')" id="s-gaming" class="btn-sala" title="Gaming">üéÆ</button>
            <button onclick="setSala('dev')" id="s-dev" class="btn-sala" title="Devs">üíª</button>

            <div class="user-profile">
                <div class="avatar" id="myAvatar">?</div>
                <span id="myName" style="font-size: 9px; font-weight: bold; color: #777;">USER</span>
            </div>
        </div>

        <div class="main-content">
            <div class="chat-header">
                <span id="roomName">üåé Chat Global</span>
                <span style="color: var(--p); font-size: 12px;">‚óè Online</span>
            </div>
            <div id="messages"></div>
            <div class="input-bar">
                <input type="text" id="msgInp" placeholder="Escribe un mensaje...">
                <button onclick="enviar()" class="btn-send">üöÄ</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded, off } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCY8Uny7ZhPeLzR9OHZsXx5wY93kpRRFrY",
            authDomain: "sekaichat-6b11a.firebaseapp.com",
            projectId: "sekaichat-6b11a",
            databaseURL: "https://sekaichat-6b11a-default-rtdb.firebaseio.com/",
            appId: "1:405655583350:web:3c04dc2f70465cbac4bd57"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let user = localStorage.getItem('sekai_v5') || "";
        let sala = 'mundo';

        // Al escribir en el login, se actualiza el avatar preview
        document.getElementById('nick').oninput = (e) => {
            const letra = e.target.value.charAt(0).toUpperCase() || "?";
            document.getElementById('avatar-preview').innerText = letra;
        };

        window.iniciar = () => {
            const n = document.getElementById('nick').value.trim();
            if(n.length < 2) return;
            user = n;
            localStorage.setItem('sekai_v5', user);
            
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('chat-screen').style.display = 'flex';
            
            // Cargar datos en el perfil lateral
            document.getElementById('myAvatar').innerText = user.charAt(0).toUpperCase();
            document.getElementById('myName').innerText = user.toUpperCase();
            
            escuchar();
        };

        window.setSala = (s) => {
            sala = s;
            const nombres = {mundo: 'üåé Chat Global', otaku: 'üéé Zona Otaku', gaming: 'üéÆ Gamers', dev: 'üíª Dev Lab'};
            document.getElementById('roomName').innerText = nombres[s];
            
            document.querySelectorAll('.btn-sala').forEach(b => b.classList.remove('active'));
            document.getElementById('s-'+s).classList.add('active');
            
            document.getElementById('messages').innerHTML = '';
            off(ref(db, 'chat_v5/' + sala));
            escuchar();
        };

        window.enviar = () => {
            const inp = document.getElementById('msgInp');
            if(!inp.value.trim()) return;
            if(inp.value === '/fiesta') confetti();
            
            push(ref(db, 'chat_v5/' + sala), {
                u: user,
                t: inp.value,
                h: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
            });
            inp.value = "";
        };

        function escuchar() {
            onChildAdded(ref(db, 'chat_v5/' + sala), (s) => {
                const d = s.val();
                const box = document.getElementById('messages');
                const div = document.createElement('div');
                div.className = `bubble ${d.u === user ? 'mine' : 'others'}`;
                div.innerHTML = `<span class="u-label">${d.u}</span>${d.t}<div class="time">${d.h}</div>`;
                box.appendChild(div);
                box.scrollTop = box.scrollHeight;
            });
        }

        document.getElementById('msgInp').onkeypress = (e) => { if(e.key==='Enter') enviar() };
        if(user) { document.getElementById('nick').value = user; iniciar(); }
    </script>
</body>
</html>
